FROM jenkins/agent:4.13.3-2-alpine3.16-jdk8

# Install additional packages
USER root
RUN apk add --update --no-cache gpg maven

# Set user and group
ARG user=jenkins
ARG group=jenkins
ARG uid=800
ARG gid=800
RUN deluser ${user} 
# RUN delgroup ${group}
RUN addgroup -g ${gid} ${group}
RUN adduser -h /home/${user} -u ${uid} -G ${group} -D ${user}
RUN chwown -R ${uid}:${gid} /home/${user}

USER ${user}

ENV MAVEN_CONFIG=/home/${user}/.m2

# create dirs
RUN ls -l -n -R /home
RUN id
RUN mkdir ${MAVEN_CONFIG} 
RUN mkdir ${MAVEN_CONFIG}/repository

# set volumes
VOLUME /home/${user}
VOLUME ${MAVEN_CONFIG}/repository
VOLUME /var/lib/jenkins_keys
