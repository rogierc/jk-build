FROM jenkins/agent:4.13.3-2-alpine3.16-jdk8

# Set user and group
ARG uid=800
ARG gid=800

# Install additional packages
USER root
RUN apk add --update --no-cache gpg maven

# Switch to user
USER ${uid}:${gid}

#set env vars
ENV JENKINS_HOME /home/jenkins
ENV MAVEN_CONFIG /home/jenkins/.m2
ENV JENKINS_KEYS /var/lib/jenkins_keys
ENV GNUPGHOME "${JENKINS_KEYS}/.gnupg"

# create dirs
RUN ls -l -n -R /home
RUN id -u
RUN mkdir ${MAVEN_CONFIG} && mkdir ${MAVEN_CONFIG}/repository

# set volumes
VOLUME /home/jenkins
VOLUME /home/jenkins/.m2/repository
VOLUME /var/lib/jenkins_keys
