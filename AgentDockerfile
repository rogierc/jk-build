FROM jenkins/agent:4.13.3-2-alpine3.16-jdk8

# Set user and group
ARG uid=800
ARG gid=800

RUN apk add --update --no-cache gpg maven

ENV JENKINS_HOME /home/jenkins
ENV MAVEN_CONFIG /home/jenkins/.m2
ENV JENKINS_KEYS /var/lib/jenkins_keys

#set user
ENV GNUPGHOME "${JENKINS_KEYS}/.gnupg"

# Switch to user
USER ${uid}:${gid}

RUN mkdir ${MAVEN_CONFIG} \
    && mkdir ${MAVEN_CONFIG}/repository

#set volumes
VOLUME /home/jenkins
VOLUME /home/jenkins/.m2/repository
VOLUME /var/lib/jenkins_keys

